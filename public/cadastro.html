<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Imunolog | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="icon" href="./assets/imagem/medicamento.png">
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link rel="stylesheet" href="./css/style.css">
  <style>
    .etapas-cadastro {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 20px;
    }

    .etapa {
      padding: 10px 20px;
      border-radius: 20px;
      background-color: #ccc;
      color: #fff;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .etapa.ativa {
      background-color: #007bff;
    }

    .card-cadastro {
      max-width: 800px;
      margin: auto;
      background-color: #ffffff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .card-cadastro h2 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 28px;
      color: #2a2a2a;
    }

    .card-cadastro h3 {
      text-align: center;
      color: #444;
      margin-bottom: 30px;
      font-size: 22px;
    }

    .formulario {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }

    .formulario .campo {
      display: flex;
      flex-direction: column;
    }

    .formulario .campo span {
      font-size: 14px;
      margin-bottom: 6px;
      color: #333;
      font-weight: 500;
    }

    .formulario .campo input {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }

    .formulario .campo input:focus {
      border-color: #007bff;
      outline: none;
    }

    /* Estiliza o select */
    .formulario select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      background-color: #fff;
      color: #333;
      appearance: none;
      /* Remove estilo padrão do navegador */
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%2710%27%20height%3D%276%27%20viewBox%3D%270%200%2010%206%27%3E%3Cpath%20fill%3D%27%23333%27%20d%3D%27M0%200l5%206%205-6z%27/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 10px 6px;
    }

    /* Remove borda azul padrão ao focar */
    .formulario select:focus {
      border-color: #007bff;
      outline: none;
    }

    /* (Opcional) Estilo das options em navegadores que permitem */
    .formulario select option {
      background-color: #fff;
      color: #333;
      font-size: 14px;
    }


    .coluna-dupla {
      grid-column: span 2;
    }

    .botao {
      grid-column: span 2;
      padding: 12px;
      font-size: 16px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .botao:hover {
      background-color: #0056b3;
    }

    /* Estilo de alerta */
    .alerta_erro {
      margin-bottom: 20px;
    }

    .card_erro {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #ffd6d6;
      color: #b30000;
      padding: 15px 25px;
      border-left: 6px solid #e60000;
      border-radius: 8px;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 9999;
      font-weight: 600;
      min-width: 250px;
    }

    .card_sucesso {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #ddffdd;
      color: #0a0;
      padding: 15px 25px;
      border-left: 6px solid #4CAF50;
      border-radius: 8px;
      display: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 9999;
      font-weight: 600;
      min-width: 250px;
    }

    #div_aguardar {
      display: none;
      text-align: center;
      margin-bottom: 15px;
      font-weight: bold;
      color: #007bff;
    }

    /* Responsividade */
    @media screen and (max-width: 768px) {
      .formulario {
        grid-template-columns: 1fr;
      }

      .botao {
        grid-column: span 1;
      }
    }
  </style>
</head>

<body onload="listarEmpresas()">
  <header>
    <div class="container">
      <div class="logo">
        <img src="./assets/imagem/logo.png" alt="Medicare" />
        <span>IMUNOLOG</span>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="sobre.html">Sobre Nós</a></li>
          <li><a href="simulador.html">Calculadora</a></li>
          <li><a href="contato.html">Contato</a></li>
        </ul>
      </nav>
      <div class="cta">
        <a href="./login.html"><button class="sign-in">Login</button></a>
        <a href="./cadastro.html"><button class="sign-in">Cadastro</button></a>
      </div>
    </div>
  </header>

  <br /><br /><br /><br /><br />

  <div class="login">
    <div class="alerta_erro">
      <div class="card_erro" id="cardErro">
        <span id="mensagem_erro"></span>
      </div>
      <div class="card_sucesso" id="cardSucesso">
        <span id="mensagem_sucesso"></span>
      </div>
      <div id="div_aguardar">Aguarde, processando cadastro...</div>
    </div>

    <div class="container">
      <div class="card card-cadastro">
        <h2>Cadastre-se</h2>

        <div class="etapas-cadastro">
          <div class="etapa ativa" id="etapa-empresa">1. Empresa</div>
          <div class="etapa" id="etapa-usuario">2. Usuário</div>
        </div>

        <!-- Etapa 1: Cadastro da Empresa -->
        <div class="formulario" id="form-etapa-1">
          <div class="campo coluna-dupla">
            <span>Nome da empresa:</span>
            <input type="text" id="empresa_nome" name="empresa_nome" placeholder="Nome da empresa"
              class="input-grande" />
          </div>
          <div class="campo">
            <span>CNPJ:</span>
            <input id="empresa_cnpj" type="text" placeholder="00.000.000/0001-00" maxlength="18" />
          </div>
          <div class="campo">
            <span>CEP:</span>
            <input id="empresa_cep" type="text" placeholder="00000-000" maxlength="9" />
          </div>
          <div class="campo">
            <span>Logradouro:</span>
            <input id="empresa_logradouro" type="text" placeholder="Rua, Avenida, etc." />
          </div>
          <div class="campo">
            <span>Número:</span>
            <input id="empresa_numero" type="text" placeholder="Número" />
          </div>
          <div class="campo">
            <span>Complemento:</span>
            <input id="empresa_complemento" type="text" placeholder="Complemento (opcional)" />
          </div>
          <div class="campo">
            <span>Bairro:</span>
            <input id="empresa_bairro" type="text" placeholder="Bairro" />
          </div>
          <div class="campo">
            <span>Cidade:</span>
            <input id="empresa_cidade" type="text" placeholder="Cidade" />
          </div>
          <div class="campo">
            <label for="empresa_uf">UF:</label>
            <select id="empresa_uf" name="empresa_uf" required>
              <option value="" disabled selected>Selecione o estado</option>
              <option value="AC">Acre (AC)</option>
              <option value="AL">Alagoas (AL)</option>
              <option value="AP">Amapá (AP)</option>
              <option value="AM">Amazonas (AM)</option>
              <option value="BA">Bahia (BA)</option>
              <option value="CE">Ceará (CE)</option>
              <option value="DF">Distrito Federal (DF)</option>
              <option value="ES">Espírito Santo (ES)</option>
              <option value="GO">Goiás (GO)</option>
              <option value="MA">Maranhão (MA)</option>
              <option value="MT">Mato Grosso (MT)</option>
              <option value="MS">Mato Grosso do Sul (MS)</option>
              <option value="MG">Minas Gerais (MG)</option>
              <option value="PA">Pará (PA)</option>
              <option value="PB">Paraíba (PB)</option>
              <option value="PR">Paraná (PR)</option>
              <option value="PE">Pernambuco (PE)</option>
              <option value="PI">Piauí (PI)</option>
              <option value="RJ">Rio de Janeiro (RJ)</option>
              <option value="RN">Rio Grande do Norte (RN)</option>
              <option value="RS">Rio Grande do Sul (RS)</option>
              <option value="RO">Rondônia (RO)</option>
              <option value="RR">Roraima (RR)</option>
              <option value="SC">Santa Catarina (SC)</option>
              <option value="SP">São Paulo (SP)</option>
              <option value="SE">Sergipe (SE)</option>
              <option value="TO">Tocantins (TO)</option>
            </select>
          </div>

          <button type="button" class="botao" onclick="mostrarEtapa2()">Próximo</button>
        </div>

        <!-- Etapa 2: Cadastro do Usuário -->
        <div class="formulario" id="form-etapa-2" style="display: none; margin-top:20px;">
          <h3>Dados do Gerente Responsavel</h3>
          <div class="campo">
            <span>Nome:</span>
            <input id="usuario_nome" type="text" placeholder="Seu nome" class="input-grande" />
          </div>
          <div class="campo">
            <span>E-mail:</span>
            <input id="usuario_email" type="email" placeholder="meuemail@provedor.com" />
          </div>
          <div class="campo">
            <span>Telefone 1:</span>
            <input id="usuario_telefone1" type="text" placeholder="(00) 00000-0000" />
          </div>
          <div class="campo">
            <span>Telefone 2 (opcional):</span>
            <input id="usuario_telefone2" type="text" placeholder="(00) 00000-0000" />
          </div>
          <div class="campo">
            <span>Senha:</span>
            <input id="usuario_senha" type="password" placeholder="Senha" />
          </div>
          <div class="campo">
            <span>Confirmar senha:</span>
            <input id="usuario_confirmar_senha" type="password" placeholder="Confirmar senha" />
          </div>
          <button type="button" class="botao" onclick="cadastrar()">Cadastrar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Função para mostrar a etapa 2, ocultando a 1 e atualizando os indicadores visuais
    function mostrarEtapa2() {
      if (!validarEtapa1()) return;

      document.getElementById("form-etapa-1").style.display = "none";
      document.getElementById("form-etapa-2").style.display = "grid";

      document.getElementById("etapa-empresa").classList.remove("ativa");
      document.getElementById("etapa-usuario").classList.add("ativa");

      esconderMensagemErro();
      esconderMensagemSucesso();
    }

    // Validação etapa 1
    function validarEtapa1() {
      var empresaNome = document.getElementById("empresa_nome").value.trim();
      var empresaCnpj = document.getElementById("empresa_cnpj").value.trim();
      var empresaCep = document.getElementById("empresa_cep").value.trim();
      var empresaLogradouro = document.getElementById("empresa_logradouro").value.trim();
      var empresaNumero = document.getElementById("empresa_numero").value.trim();
      var empresaBairro = document.getElementById("empresa_bairro").value.trim();
      var empresaCidade = document.getElementById("empresa_cidade").value.trim();
      var empresaUf = document.getElementById("empresa_uf").value;

      if (
        empresaNome === "" ||
        empresaCnpj === "" ||
        empresaCep === "" ||
        empresaLogradouro === "" ||
        empresaNumero === "" ||
        empresaBairro === "" ||
        empresaCidade === "" ||
        empresaUf === ""
      ) {
        mostrarErro("Por favor, preencha todos os campos obrigatórios da empresa.");
        return false;
      }
      esconderMensagemErro();
      return true;
    }

    // Função principal para cadastrar empresa e usuário e enviar ao backend
    function cadastrar() {
      // Mostrar loading
      document.getElementById("div_aguardar").style.display = "block";

      // Pegando valores etapa 1
      var empresaNomeComercial = document.getElementById("empresa_nome").value.trim();
      var empresaCnpj = document.getElementById("empresa_cnpj").value.trim();
      var empresaCep = document.getElementById("empresa_cep").value.trim();
      var empresaLogradouro = document.getElementById("empresa_logradouro").value.trim();
      var empresaNumero = document.getElementById("empresa_numero").value.trim();
      var empresaComplemento = document.getElementById("empresa_complemento").value.trim();
      var empresaBairro = document.getElementById("empresa_bairro").value.trim();
      var empresaCidade = document.getElementById("empresa_cidade").value.trim();
      var empresaUf = document.getElementById("empresa_uf").value;

      // Pegando valores etapa 2
      var usuarioNome = document.getElementById("usuario_nome").value.trim();
      var usuarioEmail = document.getElementById("usuario_email").value.trim();
      var usuarioTelefone1 = document.getElementById("usuario_telefone1").value.trim();
      var usuarioTelefone2 = document.getElementById("usuario_telefone2").value.trim();
      var usuarioSenha = document.getElementById("usuario_senha").value.trim();
      var usuarioConfirmarSenha = document.getElementById("usuario_confirmar_senha").value.trim();

      // Validação simples
      if (
        empresaNomeComercial === "" ||
        empresaCnpj === "" ||
        empresaCep === "" ||
        empresaLogradouro === "" ||
        empresaNumero === "" ||
        empresaBairro === "" ||
        empresaCidade === "" ||
        empresaUf === "" ||
        usuarioNome === "" ||
        usuarioEmail === "" ||
        usuarioTelefone1 === "" ||
        usuarioSenha === "" ||
        usuarioConfirmarSenha === ""
      ) {
        mostrarErro("Por favor, preencha todos os campos obrigatórios.");
        esconderLoading();
        return;
      }

      if (usuarioSenha !== usuarioConfirmarSenha) {
        mostrarErro("As senhas não coincidem.");
        esconderLoading();
        return;
      }

      const dadosCadastro = {
        empresa: {
          nomeComercial: empresaNomeComercial,
          cnpj: empresaCnpj,
          cep: empresaCep,
          logradouro: empresaLogradouro,
          numero: empresaNumero,
          complemento: empresaComplemento,
          bairro: empresaBairro,
          cidade: empresaCidade,
          uf: empresaUf
        },
        usuario: {
          nome: usuarioNome,
          email: usuarioEmail,
          telefone1: usuarioTelefone1,
          telefone2: usuarioTelefone2,
          senha: usuarioSenha
        }
      };

      fetch("/cadastroCompleto/cadastrarCompleto", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dadosCadastro),
      })
        .then(res => {
          esconderLoading();
          if (res.ok) {
            mostrarSucesso("Cadastro realizado com sucesso! Redirecionando...");
            setTimeout(() => {
              window.location.href = "login.html";
            }, 2000);
          } else {
            return res.text().then(texto => { throw new Error(texto || "Erro ao cadastrar"); });
          }
        })
        .catch(err => {
          mostrarErro(`Erro: ${err.message}`);
          esconderLoading();
        });

      return false;
    }

    function mostrarSucesso(msg) {
      const cardSucesso = document.getElementById("cardSucesso");
      const mensagemSucesso = document.getElementById("mensagem_sucesso");
      mensagemSucesso.innerHTML = msg;
      cardSucesso.style.display = "block";

      // Oculta mensagem de erro se visível
      esconderMensagemErro();

      // Auto esconde o modal após 3 segundos
      setTimeout(() => {
        esconderMensagemSucesso();
      }, 3000);
    }

    // substituir esta função
    function esconderMensagemSucesso() {
      const cardSucesso = document.getElementById("cardSucesso");
      cardSucesso.style.display = "none";
    }
    function mostrarErro(msg) {
      const cardErro = document.getElementById("cardErro");
      const mensagemErro = document.getElementById("mensagem_erro");
      mensagemErro.innerHTML = msg;
      cardErro.style.display = "block";

      // Oculta mensagem de sucesso se visível
      esconderMensagemSucesso();

      // Auto esconde após 3 segundos
      setTimeout(() => {
        esconderMensagemErro();
      }, 3000);
    }

    function esconderMensagemErro() {
      const cardErro = document.getElementById("cardErro");
      cardErro.style.display = "none";
    }

    function esconderLoading() {
      document.getElementById("div_aguardar").style.display = "none";
    }
  </script>
</body>

</html>